{% extends 'consultation/layout.html' %}
{% block content %}
{% if consultation %}

<div class="edit_consultation mb-5 bg-light p-3 border border-info rounded shadow">

    <!-- LOCKED WARNING -->
    {% if consultation.is_locked %}
        <div class="alert alert-danger fw-semibold">
            This consultation cannot be edited because prescriptions have already been issued.
        </div>
    {% endif %}

    <div class="patient-info mb-4">
        <h4>Patient</h4>
        <p><strong>ID:</strong> {{ appointment.id }}</p>
        <p><strong>Name:</strong> {{ appointment.patient }}</p>
        <p><strong>Age:</strong> {{ appointment.patient.age }}</p>
        <p><strong>Gender:</strong> {{ appointment.patient.gender }}</p>
    </div>

    <form action="{% url 'consultation:edit_consultation' consultation.id %}" method="POST">
        {% csrf_token %}

        <!-- Chief Complaint -->
        <div class="mb-3">
            <label class="form-label fw-bold">Chief Complaint</label>
            <input type="text" name="chief_comp" class="form-control"
                   value="{{ consultation.chief_comp }}"
                   {% if consultation.is_locked %}disabled{% endif %}>
        </div>

        <!-- Present Illness -->
        <div class="mb-3">
            <label class="form-label fw-bold">Present Illness</label>
            <textarea name="present_ill" class="form-control" rows="3"
                      {% if consultation.is_locked %}disabled{% endif %}>{{ consultation.present_ill }}</textarea>
        </div>

        <!-- Past Medical -->
        <div class="mb-3">
            <label class="form-label fw-bold">Past Medical History</label>
            <textarea name="past_med" class="form-control" rows="3"
                      {% if consultation.is_locked %}disabled{% endif %}>{{ consultation.past_med }}</textarea>
        </div>

        <!-- Past Surgical -->
        <div class="mb-3">
            <label class="form-label fw-bold">Past Surgical History</label>
            <textarea name="past_sur" class="form-control" rows="3"
                      {% if consultation.is_locked %}disabled{% endif %}>{{ consultation.past_sur }}</textarea>
        </div>

        <!-- Medication History -->
        <div class="mb-3">
            <label class="form-label fw-bold">Medication History</label>
            <textarea name="medica_his" class="form-control" rows="3"
                      {% if consultation.is_locked %}disabled{% endif %}>{{ consultation.medica_his }}</textarea>
        </div>

        <!-- OBGYN -->
        <div class="mb-3">
            <label class="form-label fw-bold">OB/GYN History</label>
            <textarea name="og_his" class="form-control" rows="3"
                      {% if consultation.is_locked %}disabled{% endif %}>{{ consultation.og_his }}</textarea>
        </div>

        <!-- Family History -->
        <div class="mb-3">
            <label class="form-label fw-bold">Family History</label>
            <textarea name="fam_his" class="form-control" rows="3"
                      {% if consultation.is_locked %}disabled{% endif %}>{{ consultation.fam_his }}</textarea>
        </div>

        <!-- Social History -->
        <div class="mb-3">
            <label class="form-label fw-bold">Social History</label>
            <textarea name="soc_his" class="form-control" rows="3"
                      {% if consultation.is_locked %}disabled{% endif %}>{{ consultation.soc_his }}</textarea>
        </div>

        <!-- Physical Exam -->
        <div class="mb-3">
            <label class="form-label fw-bold">Physical Examination</label>
            <textarea name="phy_exam" class="form-control" rows="3"
                      {% if consultation.is_locked %}disabled{% endif %}>{{ consultation.phy_exam }}</textarea>
        </div>

        <!-- Diagnosis -->
        <div class="mb-3">
            <label class="form-label fw-bold">Diagnosis</label>
            <textarea name="diag" class="form-control" rows="3"
                      {% if consultation.is_locked %}disabled{% endif %}>{{ consultation.diag }}</textarea>
        </div>

        <!-- Notes -->
        <div class="mb-3">
            <label class="form-label fw-bold">Notes</label>
            <textarea name="notes" class="form-control" rows="3"
                      {% if consultation.is_locked %}disabled{% endif %}>{{ consultation.notes }}</textarea>
        </div>

        <!-- Buttons -->
        <div class="consultation-button d-flex justify-content-between mt-4">

            {% if not consultation.is_locked %}
                <button type="submit" class="btn btn-primary">Update</button>
                <input type="reset" class="btn btn-outline-info" value="Clear">
            {% endif %}

            <a href="{{ request.META.HTTP_REFERER|default:fallback_url }}"
               class="btn btn-dark">Cancel</a>
        </div>

    </form>

</div>

{% endif %}
{% endblock %}
